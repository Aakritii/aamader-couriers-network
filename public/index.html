<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Aamader Couriers Network</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="style.css">
</head>

<body>

<!-- HEADER -->
<div class="topbar">
  <div class="logo" onclick="location.href='index.html'">
    Aamader Courier Networks
  </div>
  <button class="login-btn" onclick="location.href='login.html'">
    Login
  </button>
</div>

<!-- TRACK PAGE -->
<div class="track-page">
  <h2>Track Your Shipment</h2>

  <input id="trackingNumber" class="track-field" placeholder="Tracking Number">
  <br>
  <button class="submit-btn" onclick="track()">Submit</button>
</div>

<!-- ===== TRACK RESULT OVERLAY ===== -->
<div id="trackOverlay" class="overlay hidden">
  <div class="overlay-box">
    <h3 id="trackStatus"></h3>
    <p id="updatedAt" class="updated-at"></p>
    <img id="trackImage">
    <button class="close-btn" onclick="closeOverlay()">Close</button>
  </div>
</div>

<script>
async function track() {
  const tn = document.getElementById("trackingNumber").value.trim();
  const overlay = document.getElementById("trackOverlay");
  const statusEl = document.getElementById("trackStatus");
  const updatedAtEl = document.getElementById("updatedAt");
  const imageEl = document.getElementById("trackImage");

  if (!tn) {
    alert("Enter tracking number");
    return;
  }

  try {
    const res = await fetch(
      `/track?trackingNumber=${encodeURIComponent(tn)}`
    );

    const data = await res.json();

    if (data.error) {
      statusEl.innerText = data.error;
      imageEl.style.display = "none";
    } else {
      statusEl.innerText = "Status: " + data.status;

      if (data.status === "Delivered" && data.updatedAt) {
        updatedAtEl.innerText = "Delivered on: " + new Date(data.updatedAt).toLocaleDateString("en-GB");
      } else {
        updatedAtEl.innerText = "";
      }

      if (data.image) {
        imageEl.src = data.image;
        imageEl.style.display = "block";
      } else {
        imageEl.style.display = "none";
      }
    }

    overlay.classList.remove("hidden");

  } catch (err) {
    alert("Tracking failed");
    console.error(err);
  }
}

function closeOverlay() {
  document.getElementById("trackOverlay").classList.add("hidden");
}
</script>

</body>
</html>
